<div class="prices-manager-container">
  <header class="manager-header">
    <h2>Prices Data Manager</h2>
    <p>Manage NATO/USSR resource prices data with full CRUD operations</p>
  </header>


  <!-- Workdays Pricing Section -->
  <section class="workdays-section">
    <h3>Workdays Pricing</h3>
    <p>Set custom cost values for Workdays (construction labor). These values will be used in construction cost calculations.</p>

    <div class="workdays-pricing-container">
      <div class="workdays-form">
        <div class="pricing-row">
          <label for="ussrWorkdays">USSR Cost per Workday:</label>
          <div class="input-group">
            <span class="currency-symbol">₽</span>
            <input
              id="ussrWorkdays"
              type="number"
              [(ngModel)]="workdaysUSSRCost"
              step="0.01"
              min="0"
              class="workdays-input"
              placeholder="0.00">
          </div>
        </div>

        <div class="pricing-row">
          <label for="natoWorkdays">NATO Cost per Workday:</label>
          <div class="input-group">
            <span class="currency-symbol">$</span>
            <input
              id="natoWorkdays"
              type="number"
              [(ngModel)]="workdaysNATOCost"
              step="0.01"
              min="0"
              class="workdays-input"
              placeholder="0.00">
          </div>
        </div>

        <div class="workdays-actions">
          <button (click)="saveWorkdaysPricing()" class="btn-save">Save Workdays Pricing</button>
          <button (click)="resetWorkdaysPricing()" class="btn-reset">Reset to Zero</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Resources Table -->
  <section class="resources-section">
    <div class="section-header">
      <h3>Current Resource Prices ({{ resources.length }})</h3>
      <div class="section-actions" *ngIf="resources.length > 0">
        <button (click)="clearAllResources()" class="btn-danger">Clear All Resources</button>
      </div>
    </div>

    <div *ngIf="resources.length === 0" class="no-data">
      <p>No resource prices available. Use the Upload Image page to process price screenshots first.</p>
    </div>

    <div *ngIf="resources.length > 0" class="resources-table-container">
      <p-table
        #dt
        [value]="resources"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        [sortMode]="'multiple'"
        [globalFilterFields]="['name']"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [scrollable]="true"
        scrollHeight="600px"
        styleClass="p-datatable-striped">

        <!-- Search Header -->
        <ng-template pTemplate="caption">
          <div class="table-header">
            <p-iconField iconPosition="left">
              <p-inputIcon styleClass="pi pi-search"></p-inputIcon>
              <input
                pInputText
                type="text"
                (input)="onGlobalFilter(dt, $event)"
                placeholder="Search resources..."
                class="global-search"/>
            </p-iconField>
            <p-button
              type="button"
              icon="pi pi-times"
              (click)="clear(dt)"
              severity="secondary"
              [outlined]="true"
              size="small"
              *ngIf="globalFilterValue">
            </p-button>
          </div>
        </ng-template>

        <!-- Table Header -->
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="name">Resource Name <p-sortIcon field="name"></p-sortIcon></th>
            <th pSortableColumn="prices.natoSell">NATO Sell <p-sortIcon field="prices.natoSell"></p-sortIcon></th>
            <th pSortableColumn="prices.natoBuy">NATO Buy <p-sortIcon field="prices.natoBuy"></p-sortIcon></th>
            <th pSortableColumn="prices.ussrSell">USSR Sell <p-sortIcon field="prices.ussrSell"></p-sortIcon></th>
            <th pSortableColumn="prices.ussrBuy">USSR Buy <p-sortIcon field="prices.ussrBuy"></p-sortIcon></th>
            <th pSortableColumn="lastUpdated">Last Updated <p-sortIcon field="lastUpdated"></p-sortIcon></th>
            <th>Actions</th>
          </tr>
        </ng-template>

        <!-- Table Body -->
        <ng-template pTemplate="body" let-resource>
          <tr [class.editing]="originalResourceName === resource.name">
            <!-- Resource Name -->
            <td class="resource-name">
              <input
                *ngIf="originalResourceName === resource.name; else displayResourceName"
                type="text"
                [(ngModel)]="editingResource!.name"
                class="name-input"
                placeholder="Resource name">
              <ng-template #displayResourceName>{{ resource.name }}</ng-template>
            </td>

            <!-- NATO Sell -->
            <td>
              <input
                *ngIf="originalResourceName === resource.name; else displayNatoSell"
                type="number"
                [(ngModel)]="editingResource!.prices.natoSell"
                step="0.01"
                class="price-input">
              <ng-template #displayNatoSell>${{ resource.prices.natoSell | number:'1.2-2' }}</ng-template>
            </td>

            <!-- NATO Buy -->
            <td>
              <input
                *ngIf="originalResourceName === resource.name; else displayNatoBuy"
                type="number"
                [(ngModel)]="editingResource!.prices.natoBuy"
                step="0.01"
                class="price-input">
              <ng-template #displayNatoBuy>${{ resource.prices.natoBuy | number:'1.2-2' }}</ng-template>
            </td>

            <!-- USSR Sell -->
            <td>
              <input
                *ngIf="originalResourceName === resource.name; else displayUssrSell"
                type="number"
                [(ngModel)]="editingResource!.prices.ussrSell"
                step="0.01"
                class="price-input">
              <ng-template #displayUssrSell>₽{{ resource.prices.ussrSell | number:'1.2-2' }}</ng-template>
            </td>

            <!-- USSR Buy -->
            <td>
              <input
                *ngIf="originalResourceName === resource.name; else displayUssrBuy"
                type="number"
                [(ngModel)]="editingResource!.prices.ussrBuy"
                step="0.01"
                class="price-input">
              <ng-template #displayUssrBuy>₽{{ resource.prices.ussrBuy | number:'1.2-2' }}</ng-template>
            </td>

            <!-- Last Updated -->
            <td class="last-updated">{{ resource.lastUpdated | date:'short' }}</td>

            <!-- Actions -->
            <td class="actions">
              <div *ngIf="originalResourceName === resource.name; else viewActions" class="edit-actions">
                <p-button (click)="saveResource()" icon="pi pi-check" size="small" severity="success" label="Save"></p-button>
                <p-button (click)="cancelEdit()" icon="pi pi-times" size="small" severity="secondary" label="Cancel"></p-button>
              </div>
              <ng-template #viewActions>
                <div class="view-actions">
                  <p-button (click)="editResource(resource)" icon="pi pi-pencil" size="small" severity="info" label="Edit"></p-button>
                  <p-button (click)="deleteResource(resource.name)" icon="pi pi-trash" size="small" severity="danger" label="Delete"></p-button>
                </div>
              </ng-template>
            </td>
          </tr>
        </ng-template>

        <!-- Empty State -->
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="text-center">No resources found.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </section>

  <!-- Statistics -->
  <section class="stats-section" *ngIf="resources.length > 0">
    <h3>Statistics</h3>
    <div class="stats-grid">
      <div class="stat-card">
        <h4>Total Resources</h4>
        <span class="stat-value">{{ resources.length }}</span>
      </div>
      <div class="stat-card">
        <h4>Avg NATO Sell Price</h4>
        <span class="stat-value">{{ getAverageNatoSell() | number:'1.2-2' }}</span>
      </div>
      <div class="stat-card">
        <h4>Avg USSR Sell Price</h4>
        <span class="stat-value">{{ getAverageUssrSell() | number:'1.2-2' }}</span>
      </div>
    </div>
  </section>
</div>
